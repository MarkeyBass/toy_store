<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
  <title>Products API</title>
</head>

<body>
  <div class="container">
    <h1 class="display-5 mb-4 mt-4">Mark Toys PRODUCTS</h1>
    <div class="d-flex">
      <button id="add-product" class="btn btn-success me-4 mt-4">Add Product</button>
      <button id="get-all-products" class="btn btn-success me-4 mt-4">Show All Products</button>
      <a href="./users.html" class="btn btn-warning me-4 mt-4">Go To Users API</a>
    </div>

    <div id="output" class="mt-4"></div>
    <form id='form' class="mt-4" style="display:none;">
      <div class="form-group mb-4">
        <input type="number" id="part_number" placeholder="part_number" class="form-control">
      </div>
      <div class="form-group mb-4">
        <input type="text" class="form-control" id="description" placeholder="description"></textarea>
      </div>
      <div class="form-group mb-4">
        <input type="number" class="form-control" id="qty" placeholder="Quantity"></input>
      </div>
      <div class="form-group mb-4">
        <input type="number" class="form-control" id="price" placeholder="price"></input>
      </div>
      <div class="form-group mb-4">
        <input type="text" class="form-control" id="img_url" placeholder="img_url"></input>
      </div>
      <input type="submit" class="btn btn-primary mb-4" value="submit">
    </form>
  </div>

  <script>
    const form = document.getElementById('form');
    const output = document.getElementById('output');

    document.getElementById('add-product').addEventListener('click', showForm);
    document.getElementById('get-all-products').addEventListener('click', getProducts);
    form.addEventListener('submit', addProduct);

    function showForm() {
      form.style.display = 'block';
      output.innerHTML = '';
    }

    function getProducts() {
      form.style.display = 'none'
      fetch('http://localhost:5000/products/all-products')
        .then((res) => res.json())
        .then((data) => {
          console.log(data);
          output.innerHTML = "<h3>List Of Products</h3>"
          data.forEach((product) => {
            output.innerHTML += `
            <div class="card card-body mb-4">
                <h4 class="mb-4">description: ${product.description}</h4>
                <p>part_number: ${product.part_number}</p>
                <p>qty: ${product.qty}</p>
                <p>price: ${product.price}</p>
                <a href="${product.img_url}"><p>img_url: ${product.img_url}</p></a>
              </div>
            `
          });
        })
        .catch((err) => console.log(err));
    }

    function addProduct(e) {
      let reqData = {
        part_number: form.part_number.value,
        description: form.description.value,
        qty: form.qty.value,
        price: form.price.value,
        img_url: form.img_url.value,
      }

      fetch('http://localhost:5000/products/add-product', {
        method: "POST",
        headers: {
          'Accept': 'application/json, text/plain, */*',
          'Content-Type': 'application/json;charset=utf-8'
        },
        body: JSON.stringify(reqData)
      })
        .then((res) => res.json())
        .then((resData) => console.log(resData))
        .catch((err) => console.log(err));

      output.innerHTML += `
        <h4>Product was edded</h4>
        <div class="card card-body mb-3">
          <p>name: ${reqData.part_number}</p>
          <p>id: ${reqData.description}</p>
          <p>role: ${reqData.qty}</p>
          <p>email: ${reqData.price}</p>
          <p>phone: ${reqData.img_url}</p>
        </div>
      `
      form.style.display = 'none';
      form.part_number.value = ''; form.description.value = ''; form.qty.value = '';
      form.price.value = ''; form.img_url.value = '';

      e.preventDefault();
    }
  </script>

</body>

</html>